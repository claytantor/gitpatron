{% load gitpatrontags %}


{% if request.user and pull_request.issue_user.user == request.user and pull_request.fix_issue == None  %}
    <span id="pull_request_section_{{ pull_request.id }}">
        <div class="col-md-6">
           <select class="form-control" id="select_pull_{{ pull_request.id }}">
               {% for issue_fix in issues %}
                   {% if issue_fix|is_claimer:request.user and issue_fix|is_monetized_fixer:request.user == False%}
                    <option data-issue-owner="{{ issue_fix.repository.owner.user.username }}"
                            data-issue-id="{{ issue_fix.id }}"
                            data-repo-name="{{ issue_fix.repository.name }}"
                            data-github-issue="{{ issue_fix.github_issue_no }}">
                         #{{ issue_fix.github_issue_no }} {{ issue_fix.title }}
                    </option>
                   {% endif %}
               {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
         <button class="btn btn-primary associate_pull" id="button_pull_{{ pull_request.id }}"
                 data-pull-request-id ="{{ pull_request.id  }}"
                 data-issue-owner="{{ pull_request.repository.owner.user.username }}"
                 data-repo-name="{{ pull_request.repository.name }}"
                 data-github-issue="{{ pull_request.github_issue_no }}">
            <span class="glyphicon glyphicon-refresh" style="display: none" id="issue_sync_icon"></span>
            &nbsp;Associate</button>
        </div>

    </span>
{% elif pull_request.fix_issue != None  %}
    {% if  pull_request.issue_user.user == request.user %}
        {% if pull_request.fix_issue|is_monetized_fixer:request.user %}
            You monetized this.
        {% else %}
        <span  id="fixed_button_{{ claimed_issue.id }}">
            <button class="btn btn-primary has-spinner monetize_fix" id="button_pull_monitize_{{ pull_request.id }}"
                 data-pull-request-id ="{{ pull_request.id  }}"
                 data-issue-owner="{{ pull_request.repository.owner.user.username }}"
                 data-repo-name="{{ pull_request.repository.name }}"
                 data-github-issue="{{ pull_request.github_issue_no }}">
            <span class="glyphicon glyphicon-refresh" data-toggle="modal" data-target="#fix_modal"  style="display: none"></span>&nbsp;Monetize Fix</button>
        </span>
        {% endif %}
    {% else %}
        {% if pull_request.fix_issue|is_monetized_owner:request.user %}
            {% for button in pull_request.fix_issue.coinbasebutton_set.all %}
                {% if button.type == 'fix' %}
                    {{  button.code }} {{ button.type }}
                    <a class="coinbase-button"
                       data-code="{{ button.code }}"
                       data-button-style="donation_small"
                       href="https://coinbase.com/checkouts/{{ button.code }}">
                        Donate Bitcoins</a>
                    <script src="https://coinbase.com/assets/button.js" type="text/javascript"></script>
                {% endif %}
            {% endfor %}&nbsp;
        {% else %}
            Issue is associated
        {% endif %}
    {% endif %}
{% endif %}
